[
  {
    "Name": "stagefright_mp4_tx3g_64bit.rb",
    "Title": "Android Stagefright MP4 tx3g Integer Overflow",
    "Description": "This module exploits an integer overflow vulnerability in the Stagefright Library (libstagefright.so). The vulnerability occurs when parsing specially crafted MP4 files. While a wide variety of remote attack vectors exist, this particular exploit is designed to work within an HTML5 compliant browser. Exploitation is done by supplying a specially crafted MP4 file with two tx3g atoms that, when their sizes are summed, cause an integer overflow when processing the second atom. As a result, a temporary buffer is allocated with insufficient size and a memcpy call leads to a heap overflow. This version of the exploit uses a two-stage information leak based on corrupting the MetaData that the browser reads from mediaserver. This method is based on a technique published in NorthBit's Metaphor paper. First, we use a variant of their technique to read the address of a heap buffer located adjacent to a SampleIterator object as the video HTML element's videoHeight. Next, we read the vtable pointer from an empty Vector within the SampleIterator object using the video element's duration. This gives us a code address that we can use to determine the base address of libstagefright and construct a ROP chain dynamically. NOTE: the mediaserver process on many Android devices (Nexus, for example) is constrained by SELinux and thus cannot use the execve system call. To avoid this problem, the original exploit uses a kernel exploit payload that disables SELinux and spawns a shell as root. Work is underway to make the framework more amenable to these types of situations. Until that work is complete, this exploit will only yield a shell on devices without SELinux or with SELinux in permissive mode.",
    "CveIDs": [
      "CVE-2015-3864"
    ],
    "References": [
      "https://blog.exodusintel.com/2015/08/13/stagefright-mission-accomplished/",
      "http://googleprojectzero.blogspot.com/2015/09/stagefrightened.html",
      "https://raw.githubusercontent.com/NorthBit/Public/master/NorthBit-Metaphor.pdf",
      "https://github.com/NorthBit/Metaphor",
      "http://drops.wooyun.org/papers/7558",
      "http://translate.wooyun.io/2015/08/08/Stagefright-Vulnerability-Disclosure.html",
      "https://www.nccgroup.trust/globalassets/our-research/uk/whitepapers/2016/01/libstagefright-exploit-notespdf/",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/android/browser/stagefright_mp4_tx3g_64bit.rb"
    ]
  }
]
