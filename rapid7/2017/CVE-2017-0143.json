[
  {
    "Name": "ms17_010_command.rb",
    "Title": "MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution",
    "Description": "This module will exploit SMB with vulnerabilities in MS17-010 to achieve a write-what-where primitive. This will then be used to overwrite the connection session information with as an Administrator session. From there, the normal psexec command execution is done. Exploits a type confusion between Transaction and WriteAndX requests and a race condition in Transaction requests, as seen in the EternalRomance, EternalChampion, and EternalSynergy exploits. This exploit chain is more reliable than the EternalBlue exploit, but requires a named pipe.",
    "CveIDs": [
      "CVE-2017-0143",
      "CVE-2017-0146",
      "CVE-2017-0147"
    ],
    "References": [
      "http://technet.microsoft.com/en-us/security/bulletin/MS17-010",
      "https://github.com/worawit/MS17-010",
      "https://hitcon.org/2017/CMT/slide-files/d2_s2_r0.pdf",
      "https://blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis/",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/admin/smb/ms17_010_command.rb"
    ]
  },
  {
    "Name": "smb_ms17_010.rb",
    "Title": "MS17-010 SMB RCE Detection",
    "Description": "Uses information disclosure to determine if MS17-010 has been patched or not. Specifically, it connects to the IPC$ tree and attempts a transaction on FID 0. If the status returned is \"STATUS_INSUFF_SERVER_RESOURCES\", the machine does not have the MS17-010 patch. If the machine is missing the MS17-010 patch, the module will check for an existing DoublePulsar (ring 0 shellcode/malware) infection. This module does not require valid SMB credentials in default server configurations. It can log on as the user \"\\\" and connect to IPC$.",
    "CveIDs": [
      "CVE-2017-0143",
      "CVE-2017-0144",
      "CVE-2017-0145",
      "CVE-2017-0146",
      "CVE-2017-0147",
      "CVE-2017-0148"
    ],
    "References": [
      "http://technet.microsoft.com/en-us/security/bulletin/MS17-010",
      "https://zerosum0x0.blogspot.com/2017/04/doublepulsar-initial-smb-backdoor-ring.html",
      "https://github.com/countercept/doublepulsar-detection-script",
      "https://web.archive.org/web/20170513050203/https://technet.microsoft.com/en-us/library/security/ms17-010.aspx",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/smb/smb_ms17_010.rb"
    ]
  },
  {
    "Name": "ms17_010_eternalblue.rb",
    "Title": "MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption",
    "Description": "This module is a port of the Equation Group ETERNALBLUE exploit, part of the FuzzBunch toolkit released by Shadow Brokers. There is a buffer overflow memmove operation in Srv!SrvOs2FeaToNt. The size is calculated in Srv!SrvOs2FeaListSizeToNt, with mathematical error where a DWORD is subtracted into a WORD. The kernel pool is groomed so that overflow is well laid-out to overwrite an SMBv1 buffer. Actual RIP hijack is later completed in srvnet!SrvNetWskReceiveComplete. This exploit, like the original may not trigger 100% of the time, and should be run continuously until triggered. It seems like the pool will get hot streaks and need a cool down period before the shells rain in again. The module will attempt to use Anonymous login, by default, to authenticate to perform the exploit. If the user supplies credentials in the SMBUser, SMBPass, and SMBDomain options it will use those instead. On some systems, this module may cause system instability and crashes, such as a BSOD or a reboot. This may be more likely with some payloads.",
    "CveIDs": [
      "CVE-2017-0143",
      "CVE-2017-0144",
      "CVE-2017-0145",
      "CVE-2017-0146",
      "CVE-2017-0147",
      "CVE-2017-0148"
    ],
    "EdbIDs": [
      "EDB-42030"
    ],
    "References": [
      "http://technet.microsoft.com/en-us/security/bulletin/MS17-010",
      "https://github.com/RiskSense-Ops/MS17-010",
      "https://risksense.com/wp-content/uploads/2018/05/White-Paper_Eternal-Blue.pdf",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/smb/ms17_010_eternalblue.rb"
    ]
  },
  {
    "Name": "ms17_010_psexec.rb",
    "Title": "MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution",
    "Description": "This module will exploit SMB with vulnerabilities in MS17-010 to achieve a write-what-where primitive. This will then be used to overwrite the connection session information with as an Administrator session. From there, the normal psexec payload code execution is done. Exploits a type confusion between Transaction and WriteAndX requests and a race condition in Transaction requests, as seen in the EternalRomance, EternalChampion, and EternalSynergy exploits. This exploit chain is more reliable than the EternalBlue exploit, but requires a named pipe.",
    "CveIDs": [
      "CVE-2017-0143",
      "CVE-2017-0146",
      "CVE-2017-0147"
    ],
    "References": [
      "http://technet.microsoft.com/en-us/security/bulletin/MS17-010",
      "https://github.com/worawit/MS17-010",
      "https://hitcon.org/2017/CMT/slide-files/d2_s2_r0.pdf",
      "https://blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis/",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/smb/ms17_010_psexec.rb"
    ]
  },
  {
    "Name": "smb_doublepulsar_rce.rb",
    "Title": "SMB DOUBLEPULSAR Remote Code Execution",
    "Description": "This module executes a Metasploit payload against the Equation Group's DOUBLEPULSAR implant for SMB as popularly deployed by ETERNALBLUE. While this module primarily performs code execution against the implant, the \"Neutralize implant\" target allows you to disable the implant.",
    "CveIDs": [
      "CVE-2017-0143",
      "CVE-2017-0144",
      "CVE-2017-0145",
      "CVE-2017-0146",
      "CVE-2017-0147",
      "CVE-2017-0148"
    ],
    "References": [
      "http://technet.microsoft.com/en-us/security/bulletin/MS17-010",
      "https://zerosum0x0.blogspot.com/2017/04/doublepulsar-initial-smb-backdoor-ring.html",
      "https://countercept.com/blog/analyzing-the-doublepulsar-kernel-dll-injection-technique/",
      "https://www.countercept.com/blog/doublepulsar-usermode-analysis-generic-reflective-dll-loader/",
      "https://github.com/countercept/doublepulsar-detection-script",
      "https://github.com/countercept/doublepulsar-c2-traffic-decryptor",
      "https://gist.github.com/msuiche/50a36710ee59709d8c76fa50fc987be1",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/smb/smb_doublepulsar_rce.rb"
    ]
  }
]
