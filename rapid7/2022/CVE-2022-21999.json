[
  {
    "Name": "cve_2022_21999_spoolfool_privesc.rb",
    "Title": "CVE-2022-21999 SpoolFool Privesc",
    "Description": "The Windows Print Spooler has a privilege escalation vulnerability that can be leveraged to achieve code execution as SYSTEM. The `SpoolDirectory`, a configuration setting that holds the path that a printer's spooled jobs are sent to, is writable for all users, and it can be configured via `SetPrinterDataEx()` provided the caller has the `PRINTER_ACCESS_ADMINISTER` permission. If the `SpoolDirectory` path does not exist, it will be created once the print spooler reinitializes. Calling `SetPrinterDataEx()` with the `CopyFiles\\` registry key will load the dll passed in as the `pData` argument, meaning that writing a dll to the `SpoolDirectory` location can be loaded by the print spooler. Using a directory junction and UNC path for the `SpoolDirectory`, the exploit writes a payload to `C:\\Windows\\System32\\spool\\drivers\\x64\\4` and loads it by calling `SetPrinterDataEx()`, resulting in code execution as SYSTEM.",
    "CveIDs": [
      "CVE-2022-21999"
    ],
    "References": [
      "https://research.ifcr.dk/spoolfool-windows-print-spooler-privilege-escalation-cve-2022-22718-bf7752b68d81",
      "https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/local/cve_2022_21999_spoolfool_privesc.rb"
    ]
  }
]
